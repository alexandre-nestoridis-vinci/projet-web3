<app-header></app-header>

<main class="main-container">
  <section class="filter-section">
    <app-category-filter 
      (newsGenerated)="onNewsGenerated($event)">
    </app-category-filter>
  </section>

  <section class="global-search-container">
    <div class="search-input-wrapper">
      <input
        type="search"
        placeholder="Rechercher parmi toutes les actualités..."
        [value]="searchTerm"
        #globalSearch
        (focus)="onSearchFocus()"
        (input)="onSearchInput(globalSearch.value)"
        (keyup.enter)="onSearchSubmit()"
        class="global-search-input"
      />
      <button *ngIf="searchTerm.length > 0" class="clear-search-button" (click)="clearSearch()">
      </button>
      </div>

    <ul *ngIf="suggestionResults.length > 0 && searchTerm.length >= 0" class="suggestions">
      <li *ngFor="let s of suggestionResults" (click)="onSelectSuggestion(s)">
        <strong>{{ s.title }}</strong>
        <div class="suggestion-meta">{{ s.source }} — {{ s.publishedAt ? (s.publishedAt | date:'short') : '' }}</div>
      </li>
    </ul>
  </section>

  <section class="news-content">

    <div *ngIf="searchActive">
      <div class="results-grid">
        <app-news-card *ngFor="let a of searchResults" [article]="a"></app-news-card>
      </div>
    </div>

    <div *ngIf="!searchActive && (!activeCategories || activeCategories.length === 0)">
      <div class="results-grid">
        <app-news-card *ngFor="let a of articles" [article]="a"></app-news-card>
      </div>
    </div>

    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner"></div>
      <p>Récupération des actualités en cours...</p>
    </div>

    <div *ngIf="!isLoading && articles.length === 0" class="empty-state">
      <h2>Aucune actualité disponible</h2>
      <p>Utilisez le bouton Générer pour récupérer les dernières actualités IA.</p>
    </div>
  </section>
</main>

<router-outlet></router-outlet>